#!/usr/bin/env ruby

# Most code janked from https://github.com/firmhouse/heroku-buildpack-ruby-freetds/blob/master/bin/compile

# sync output
$stdout.sync = true

puts "Installing freetds into #{ARGV[0]}/vendor/freetds"
puts `mkdir -p #{ARGV[0]}/vendor/freetds`
puts `curl https://s3.amazonaws.com/firmhouse/freetds-0.tgz -o - | tar -xz -C #{ARGV[0]}/vendor/freetds -f -`

puts "-----> Writing FreeTDS configuration for subsequent buildpack"
File.open("export", "w") do |file|
  file.write("export FREETDS_DIR=#{ARGV[0]}/vendor/freetds")
end
